<!DOCTYPE html>
<html>
<head>
    <title>T1140.000.01</title>
    <link rel="stylesheet" type="text/css" href="KISA_HTML_CSS.css">
</head>
<body>
<h1>T1140.000.01 Base64 인코딩 데이터 복호화 후 파일 생성</h1>

<h2>D3FEND</h2>

<p>MITRE ATT&amp;CK 액션을 기준으로 대응 방안을 작성</p>

<h3>Detection</h3>

<p>certutil 도구를 이용해 Base64로 인코딩된 파일을 -decode 옵션으로 디코딩하는 행위를 탐지한다. </p>

<h3>Detection(EDR)</h3>

<p><img src="T1140.000.01.PNG" alt="" />
https://172.18.10.125:8903/#/analysis/alert/66f3d441002dc795000000f2</p>

<h3>Response</h3>

<ol>
<li><p>파일 및 시스템 분석
파일 생성 및 변경 모니터링: 시스템에서 의심스러운 파일이 생성되거나 기존 파일이 변경된 이력을 모니터링합니다. 특히, 최근에 생성된 파일이 Base64로 인코딩된 내용을 디코딩하여 만들어진 파일인지 확인합니다.
디코딩된 파일 분석: 공격자가 Base64로 인코딩된 데이터를 디코딩하여 생성한 파일의 유형과 내용을 분석합니다. 파일이 실행 가능한 바이너리 파일인지, 스크립트 파일인지 또는 다른 유형의 파일인지 확인하고, 악성 코드가 포함되어 있는지 조사합니다.
로그 및 히스토리 확인: 시스템 및 애플리케이션 로그를 분석하여 Base64 디코딩이 이루어진 시점과, 해당 명령이 실행된 사용자 및 프로세스를 확인합니다. 명령어 히스토리 또는 로그를 통해 공격자가 사용한 도구와 명령어를 파악합니다.</p></li>
<li><p>디코딩 활동의 출처 추적
디코딩 명령어 조사: base64 명령어, certutil, PowerShell의 Base64 디코딩 함수 등, 공격자가 사용한 디코딩 명령어를 추적하여 어떤 프로세스가 실행했는지 확인합니다.
사용자 및 프로세스 조사: 디코딩 작업이 실행된 사용자의 권한 및 계정 활동을 조사하여, 내부 사용자 계정이 악용되었는지 확인합니다. 또한, 디코딩을 수행한 프로세스의 부모 프로세스와 관련된 활동을 추적합니다.
네트워크 활동 분석: 디코딩된 파일이 외부 서버로부터 다운로드되었거나 외부로 전송되었는지 네트워크 트래픽 로그를 분석합니다. 공격자가 C&amp;C 서버와 통신하여 Base64로 인코딩된 데이터를 수신했거나 전송했는지 여부를 확인합니다.</p></li>
<li><p>격리 및 제거 조치
의심스러운 파일 격리: 디코딩된 결과로 생성된 파일을 격리하여 분석하고, 악성 코드로 확인된 경우 해당 파일을 삭제합니다. 파일이 격리된 후, 시스템의 백업 및 무결성 검사를 통해 동일한 파일이 다른 위치에 존재하지 않는지 확인합니다.
프로세스 종료 및 시스템 격리: 악성 활동을 수행한 프로세스를 종료하고, 필요 시 해당 시스템을 네트워크에서 격리하여 추가적인 피해를 방지합니다.
시스템 복구: 감염된 시스템을 초기화하고, 중요한 데이터만 복구하여 공격자가 설치한 악성 프로그램이나 백도어가 없는 상태로 복원합니다. 복원 후, 시스템이 최신 보안 패치 상태를 유지하도록 합니다.</p></li>
<li><p>사고 보고 및 법적 대응
내부 보고 및 공유: 내부 보안 팀 및 관련 부서에 해당 공격 활동을 보고하고, 공격의 범위 및 피해를 파악하여 추가적인 대응 조치를 마련합니다.
법적 대응: 필요 시 법 집행 기관에 해당 공격 활동을 보고하고, 수사에 필요한 증거 자료를 수집 및 제공하여 법적 대응을 지원합니다.
직원 교육 및 인식 강화: 공격자가 사용한 수법에 대해 직원들에게 교육하고, Base64 인코딩된 악성 코드의 위험성을 인식하도록 하여 유사한 공격이 재발하지 않도록 예방합니다.</p></li>
</ol>

<h3>Mitigations</h3>

<ol>
<li><p><strong>파일 인코딩/디코딩 활동 제한</strong></p>

<ul>
<li>파일 디코딩 및 생성 정책 강화
<ul>
<li>시스템에서 Base64와 같은 인코딩/디코딩 활동을 감시하고, 승인되지 않은 파일 디코딩 및 생성 활동을 제한합니다.</li>
<li>디코딩 명령어 사용을 최소화하고, 필요한 경우 승인된 사용자만 사용할 수 있도록 설정합니다.</li>
</ul></li>
<li>애플리케이션 제어(whitelisting)
<ul>
<li>시스템에서 허용된 애플리케이션만 실행되도록 설정하고, Base64 디코딩을 수행할 수 있는 도구(예: certutil, base64, PowerShell)의 실행을 제어합니다.</li>
<li>이러한 도구가 악용되지 않도록 제한된 환경에서만 사용 가능하도록 합니다.</li>
</ul></li>
<li>스크립트 실행 제한
<ul>
<li>PowerShell, Bash 등 스크립트 언어의 실행 정책을 강화하여, 외부 스크립트의 실행을 제한하거나 승인된 스크립트만 실행되도록 설정합니다.</li>
</ul></li>
</ul></li>
<li><p><strong>디코딩된 데이터 및 파일 탐지 강화</strong></p>

<ul>
<li>파일 및 프로세스 모니터링
<ul>
<li>인코딩/디코딩 활동과 관련된 명령어와 프로세스를 실시간으로 모니터링하여, 승인되지 않은 디코딩 활동이 탐지될 경우 즉시 경고를 발생시키고 차단합니다.</li>
</ul></li>
<li>파일 무결성 검사(FIM)
<ul>
<li>중요한 시스템 및 서버에 대해 파일 무결성 검사(FIM: File Integrity Monitoring)를 설정하여, 승인되지 않은 파일의 생성 및 변경을 탐지하고 이를 차단합니다.</li>
</ul></li>
<li>네트워크 필터링 및 트래픽 모니터링
<ul>
<li>네트워크 트래픽을 모니터링하여, Base64로 인코딩된 데이터가 전송되는지 여부를 감지하고, 이러한 트래픽이 탐지되면 차단합니다.</li>
<li>악성 데이터 전송을 예방하기 위해 C&amp;C 서버와의 통신을 모니터링하고 차단합니다.</li>
</ul></li>
</ul></li>
<li><p><strong>악성 스크립트 및 인코딩된 데이터 탐지</strong></p>

<ul>
<li>서명 기반 탐지
<ul>
<li>Base64로 인코딩된 악성 데이터가 포함된 스크립트나 명령어를 탐지하기 위해, 알려진 악성 스크립트의 서명을 기반으로 탐지 규칙을 설정합니다.</li>
</ul></li>
<li>행동 기반 탐지
<ul>
<li>인코딩된 데이터를 디코딩하고 이를 파일로 저장하려는 시도와 같은 비정상적인 행동을 탐지하고 차단하기 위해 행동 기반 탐지 규칙을 설정합니다.</li>
</ul></li>
<li>침입 방지 시스템(IPS) 설정 강화
<ul>
<li>침입 방지 시스템에서 Base64 인코딩된 데이터의 전송 및 다운로드를 모니터링하고 차단할 수 있도록 설정을 강화합니다.</li>
</ul></li>
</ul></li>
<li><p><strong>사용자 교육 및 인식 강화</strong></p>

<ul>
<li>의심스러운 파일 및 스크립트 주의 교육
<ul>
<li>직원들에게 의심스러운 인코딩된 파일이나 스크립트를 열거나 실행하지 않도록 교육합니다.</li>
<li>이메일 첨부 파일이나 웹사이트에서 다운로드한 파일이 Base64로 인코딩된 경우, 이를 열기 전에 반드시 보안 부서에 보고하도록 합니다.</li>
</ul></li>
<li>보안 인식 훈련
<ul>
<li>소셜 엔지니어링 기법이나 피싱 공격을 통해 인코딩된 악성 파일이 전송되는 경우를 대비하여, 보안 인식 훈련을 실시하고 이러한 공격에 대비할 수 있도록 합니다.</li>
</ul></li>
</ul></li>
<li><p><strong>디코딩 및 인코딩 활동 로깅 및 분석</strong></p>

<ul>
<li>디코딩 활동 로깅
<ul>
<li>시스템에서 실행되는 모든 디코딩 활동을 로깅하고, 이러한 로그를 주기적으로 분석하여 비정상적인 활동이 발견될 경우 조치를 취합니다.</li>
</ul></li>
<li>로그 및 이벤트 관리 강화
<ul>
<li>중앙 집중식 로그 및 이벤트 관리 시스템(SIEM)을 통해 디코딩 및 인코딩 활동의 로그를 수집하고 분석하여, 의심스러운 활동이 발견될 경우 즉시 경고를 발생시키고 대응할 수 있도록 합니다.</li>
</ul></li>
<li>정기적인 보안 점검
<ul>
<li>정기적으로 보안 점검 및 모의 해킹 테스트를 실시하여, Base64 인코딩 및 디코딩과 관련된 취약점을 식별하고 이를 보완합니다.</li>
</ul></li>
</ul></li>
</ol>

<h2>Affected Techniques</h2>

<p>Action 실행시 함께 영향을 받는 다른 Techniqes </p>

<table>
<thead>
<tr>
  <th style="text-align:center;">ATT&amp;CK</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:center;">T1140</td>
</tr>
<tr>
  <td style="text-align:center;">T1027.003</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
  <th style="text-align:center;">D3FEND</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:center;">D3-FIM File Integrity Monitoring</td>
</tr>
<tr>
  <td style="text-align:center;">D3-ISL Executable Allowlisting</td>
</tr>
<tr>
  <td style="text-align:center;">D3-ELM File Integrity Monitoring</td>
</tr>
<tr>
  <td style="text-align:center;">D3-ELM File Access Pattern Analysis</td>
</tr>
<tr>
  <td style="text-align:center;">D3-ELM System File Analysis</td>
</tr>
</tbody>
</table>

</body>
</html>
