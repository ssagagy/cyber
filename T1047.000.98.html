<!DOCTYPE html>
<html>
<head>
    <title>T1047.000.98</title>
    <link rel="stylesheet" type="text/css" href="KISA_HTML_CSS.css">
</head>
<body>
<h1>T1047.000.98 Wmic를 이용 AD서버에서 악성코드 다운로드</h1>

<h2>D3FEND</h2>

<p>MITRE ATT&amp;CK 액션을 기준으로 대응 방안을 작성</p>

<h3>Detection</h3>

<ul>
<li>CurrentProcess = "powershell.exe" AND </li>
<li>Action = "AmsiScan" AND </li>
<li>AmsiScanBuffer = "SetPropValue.CommandLine(" AND ""iwr" AND "SetPropValue.CommandLine(" AND</li>
</ul>

<h3>Detection(EDR)</h3>

<p><img src="T1047.000.98.png" alt="T1047 000 98" /></p>

<h3>Response</h3>

<ul>
<li>공격자가 생성한 파일을 삭제합니다.</li>
<li>공격자에 의해 PC가 제어되었을 가능성이 있으므로 호스트 네트워크를 격리합니다.</li>
</ul>

<h3>Mitigations</h3>

<ol>
<li><strong>권한 제한 (Privileged Account Management)</strong></li>
</ol>

<ul>
<li>최소 권한 원칙 적용:
<ul>
<li>WMIC 사용은 관리자 계정에서만 가능하도록 설정합니다.</li>
<li>AD 서버에서 권한이 과도한 계정을 제한하고, 필요 최소한의 권한만 부여합니다.</li>
</ul></li>
<li>서비스 계정 모니터링:
<ul>
<li>서비스 계정이 비정상적으로 WMIC를 실행하지 않도록 강력한 정책을 구성합니다.</li>
</ul></li>
</ul>

<ol start="2">
<li><strong>WMIC 비활성화 (Disable or Restrict WMIC)</strong></li>
</ol>

<ul>
<li>WMIC 비활성화:
<ul>
<li>AD 서버에서 WMIC 사용을 제한하거나 비활성화하여 악용을 방지합니다.</li>
<li>Windows 설정에서 WMIC를 명시적으로 차단하거나 wbem 디렉터리에 대한 액세스를 제한합니다.</li>
</ul></li>
<li>AppLocker 또는 WDAC 정책 사용:
<ul>
<li>WMIC 실행 파일(wmic.exe) 및 의심스러운 스크립트를 차단하도록 AppLocker나 Windows Defender Application Control(정책 기반 제어 도구)을 설정합니다.</li>
</ul></li>
</ul>

<ol start="3">
<li><strong>네트워크 보호 (Network Segmentation &amp; Firewall Rules)</strong></li>
</ol>

<ul>
<li>내부 네트워크 트래픽 제어:
<ul>
<li>AD 서버의 인터넷 접속을 제한하고, 악성코드 다운로드를 위해 사용되는 도메인이나 IP 주소를 방화벽에서 차단합니다.</li>
</ul></li>
<li>프록시 사용:
<ul>
<li>HTTP/HTTPS 트래픽을 모니터링하고 의심스러운 다운로드를 차단하도록 프록시 서버를 설정합니다.</li>
</ul></li>
</ul>

<ol start="4">
<li><strong>로그 및 모니터링 (Log &amp; Monitor Activities)</strong></li>
</ol>

<ul>
<li>WMIC 실행 모니터링:
<ul>
<li>WMIC 명령 실행 로그를 Windows 이벤트 로그(Event ID 4688) 및 WMI 로그를 통해 모니터링합니다.</li>
<li>WMIC를 사용한 외부 연결 시도를 탐지하고 경고하도록 SIEM 도구를 구성합니다.</li>
</ul></li>
<li>파일 다운로드 모니터링:
<ul>
<li>의심스러운 네트워크 요청이나 외부 파일 다운로드를 감지하기 위해 IDS/IPS 및 네트워크 트래픽 분석 도구를 사용합니다.</li>
</ul></li>
</ul>

<ol start="5">
<li><strong>WMIC 스크립트 차단 (Script Prevention)</strong></li>
</ol>

<ul>
<li>스크립트 사용 제한:
<ul>
<li>WMIC를 통해 특정 악성 명령이 실행되지 않도록 사용자 지정 그룹 정책(GPO)을 활용하여 명령어 패턴을 차단합니다.</li>
</ul></li>
<li>파일 및 프로세스 기반 탐지:
<ul>
<li>악성코드 배포에 사용될 가능성이 높은 WMIC 명령어를 스캔하고, 의심스러운 실행을 종료합니다.</li>
</ul></li>
</ul>

<ol start="6">
<li><strong>교육 및 인식 (User Training &amp; Awareness)</strong></li>
</ol>

<ul>
<li>사용자 보안 교육:
<ul>
<li>관리자 및 네트워크 운영자에게 WMIC 악용 가능성 및 악성코드 다운로드를 예방하기 위한 대응 방법을 교육합니다.</li>
</ul></li>
<li>보안 캠페인:
<ul>
<li>AD 서버 관리 및 보안 모범 사례를 전사적으로 공유합니다.</li>
</ul></li>
</ul>

<ol start="7">
<li><strong>패치 및 업데이트 (Patch Management)</strong></li>
</ol>

<ul>
<li>시스템 업데이트:
<ul>
<li>Windows 운영 체제 및 관련 서비스의 최신 보안 패치를 적용하여 WMIC를 악용한 공격 벡터를 최소화합니다.</li>
</ul></li>
</ul>

<h2>Affected Techniques</h2>

<p>Action 실행시 함께 영향을 받는 다른 Techniqes </p>

<table>
<thead>
<tr>
  <th style="text-align:center;">ATT&amp;CK</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:center;">T1047.000.98</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
  <th style="text-align:center;">D3FEND</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:center;">D3-SICA System Init C</td>
</tr>
<tr>
  <td style="text-align:center;">D3-DA Dynamic Analysis</td>
</tr>
<tr>
  <td style="text-align:center;">D3-PM Platform Monitoring</td>
</tr>
<tr>
  <td style="text-align:center;">D3-PSA Process Spawn Analysis</td>
</tr>
<tr>
  <td style="text-align:center;">D3-FIM File Integrity Monitoring</td>
</tr>
<tr>
  <td style="text-align:center;">D3-NTF Network Traffic Filtering</td>
</tr>
<tr>
  <td style="text-align:center;">D3-ITF Inbound Traffic Filtering</td>
</tr>
<tr>
  <td style="text-align:center;">D3-OTF Outbound Traffic Filtering</td>
</tr>
</tbody>
</table>

</body>
</html>
