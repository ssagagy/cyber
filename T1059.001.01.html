<!DOCTYPE html>
<html>
<head>
    <title>T1059.001.01</title>
    <link rel="stylesheet" type="text/css" href="KISA_HTML_CSS.css">
</head>
<body>
<h1>T1059.001.01 windows command shell</h1>

<h2>D3FEND</h2>

<p>MITRE ATT&amp;CK 액션을 기준으로 대응 방안을 작성</p>

<h3>Detection</h3>

<p>Powershell 환경에서 프로그램을 실행할 때 탐지합니다.</p>

<h3>Detection(EDR)</h3>

<p><img src="T1059.001.01.png" alt="" />
https://172.18.10.125:8903/#/event/edr/66f39864002dc7940000031b</p>

<h3>Response</h3>

<p>해당 행위를 수행한 프로세스를 종료합니다.</p>

<h3>Mitigations</h3>

<ol>
<li><p><strong>PowerShell 실행 정책 강화 (M1038 - Execution Prevention)</strong>  </p>

<ul>
<li><strong>PowerShell 스크립트 실행 정책을 제한적으로 설정</strong> (예: <code data-language="powershell">AllSigned</code>, <code data-language="powershell">RemoteSigned</code> 등)  </li>
<li><strong>스크립트 실행을 엄격하게 제한</strong>하여 승인된 서명된 스크립트만 실행 가능하도록 설정  </li>
<li>PowerShell <strong>스크립트 블록 로깅</strong>을 활성화하여 PowerShell 명령 및 스크립트 실행 기록을 로깅  </li>
<li>PowerShell <strong>Constrained Language Mode</strong>를 활성화하여 비인가된 스크립트나 명령이 실행되지 않도록 차단  </li>
</ul></li>
<li><p><strong>PowerShell 암호화 및 악성 스크립트 탐지 (M1047 - System Logging &amp; Monitoring)</strong>  </p>

<ul>
<li><strong>PowerShell 명령의 로그 기록 활성화</strong> (스크립트 블록 로깅 및 전역 로깅 활성화)  </li>
<li><strong>Sysmon (Event ID 1)</strong>을 사용하여 PowerShell 프로세스와 그 실행 내역을 모니터링  </li>
<li>PowerShell 로그에서 의심스러운 명령어나 스크립트 실행 탐지 및 분석  </li>
<li><strong>EDR/XDR 솔루션</strong>을 사용하여 PowerShell을 통한 <strong>악성 코드 실행 및 비정상적인 명령 활동</strong> 탐지  </li>
</ul></li>
<li><p><strong>PowerShell 및 관련 도구 사용 제한 (M1038 - Execution Prevention)</strong>  </p>

<ul>
<li><strong>AppLocker</strong> 또는 <strong>WDAC(Windows Defender Application Control)</strong>를 사용하여 PowerShell 및 비정상적인 실행 파일의 실행을 제한  </li>
<li><strong>PowerShell의 비인가된 실행을 차단</strong>하고, <strong>관리자 계정만 PowerShell을 실행</strong>할 수 있도록 제한  </li>
<li><strong>PowerShell의 원격 실행(Remote PowerShell)</strong> 기능을 비활성화하여 <strong>원격 공격 방지</strong>  </li>
</ul></li>
<li><p><strong>정상적인 PowerShell 스크립트와 비정상적인 스크립트 구별 (M1040 - Behavior-Based Detection)</strong>  </p>

<ul>
<li><strong>EDR/XDR을 활용하여 PowerShell 명령 및 스크립트의 비정상적인 실행을 실시간으로 탐지</strong>  </li>
<li>PowerShell 스크립트가 <strong>시스템과 네트워크에 대한 권한을 남용하는 행위를 탐지하고 차단</strong>  </li>
<li><strong>PowerShell 원격 세션을 통한 비정상적인 명령어 실행</strong> 탐지 및 차단  </li>
</ul></li>
<li><p><strong>사용자 계정 및 권한 관리 (M1018 - User Account Management)</strong>  </p>

<ul>
<li><strong>PowerShell을 사용할 수 있는 사용자 계정을 최소화</strong>하고, <strong>최소 권한 원칙(Least Privilege Principle)</strong>을 적용하여 공격자가 PowerShell을 악용할 기회를 차단  </li>
<li><strong>UAC(User Account Control)</strong>를 설정하여 관리자 권한을 요구하는 PowerShell 명령 실행 시 승인을 받도록 강제  </li>
<li>관리자가 아닌 계정에서 <strong>PowerShell 실행을 차단</strong>하거나 제한적인 권한만 부여  </li>
</ul></li>
<li><p><strong>파일 및 명령어 모니터링 (M1043 - Code Signing)</strong>  </p>

<ul>
<li><strong>PowerShell 스크립트 및 명령어 파일에 디지털 서명을 적용</strong>하여 서명되지 않은 파일의 실행을 차단  </li>
<li><strong>해당 스크립트가 비정상적으로 수정되거나 의심스러운 스크립트가 실행될 경우 경고를 발송</strong>  </li>
<li>PowerShell 명령어가 <strong>네트워크 및 시스템에서 민감한 작업을 수행하는지 감시</strong>  </li>
</ul></li>
</ol>

<h2>Affected Techniques</h2>

<p>Action 실행시 함께 영향을 받는 다른 Techniqes </p>

<table>
<thead>
<tr>
  <th style="text-align:center;">ATT&amp;CK</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:center;">T1059.001</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
  <th style="text-align:center;">D3FEND</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:center;">D3-PM Platform Monitoring</td>
</tr>
<tr>
  <td style="text-align:center;">D3-PLA Process Lineage Analysis</td>
</tr>
<tr>
  <td style="text-align:center;">D3-PCA Process Code Segment Verification</td>
</tr>
</tbody>
</table>

</body>
</html>
