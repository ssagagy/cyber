<!DOCTYPE html>
<html>
<head>
    <title>T1070.003.01</title>
    <link rel="stylesheet" type="text/css" href="KISA_HTML_CSS.css">
</head>
<body>
<h1>T1070.003.01 호스트에서 흔적 삭제: 명령어 히스토리 삭제</h1>

<h2>D3FEND</h2>

<p>MITRE ATT&amp;CK 액션을 기준으로 대응 방안을 작성</p>

<h3>Detection</h3>

<p>~/.bash<em>history 파일은 사용자 세션에서 실행된 명령어 기록을 저장하는 파일이다. bash</em>history 파일 삭제를 탐지하려면 해당 파일의 비정상적인 변경이나 삭제를 모니터링해야 한다.
1. bash<em>history 파일 삭제 또는 변경 탐지 : bash</em>history 파일에 대한 삭제나 변경을 실시간으로 모니터링할 수 있다. 이를 위해서는 Auditd와 같은 도구를 사용하여 파일 접근 및 삭제 이벤트를 추적할 수 있다.
2. bash<em>history 파일 크기 및 무결성 체크 : bash</em>history 파일이 갑자기 크기가 줄거나 내용이 사라진 경우 이를 탐지할 수 있다. 정기적으로 파일 크기와 해시값을 확인하고, 무결성 검사를 통해 삭제나 변경을 감지할 수 있다.
3. 비정상 세션 종료 시 탐지 : 공격자는 세션을 종료하기 전에 bash<em>history 파일을 삭제하거나 명령어 기록을 남기지 않도록 설정할 수 있다. 세션 종료 시점에 비정상적으로 bash</em>history 파일이 지워졌거나 비어 있는지 탐지하는 것이 중요하다.</p>

<h3>Detection(EDR)</h3>

<p><img src="캡처.PNG" alt="캡처" /></p>

<h3>Response</h3>

<ol>
<li>삭제된 bash<em>history 파일 복구 : 공격자가 bash</em>history 파일을 삭제한 경우 이를 복구할 수 있는지 포렌식 도구를 사용해 시도한다. 시스템의 스냅샷이나 백업을 통해 복원할 수 있는지 확인한다.</li>
<li>관련된 세션 및 사용자 활동 조사 : 로그 분석을 통해 해당 사용자의 다른 활동이나 세션에서 비정상적인 명령 실행이 있었는지 확인한다. 공격자가 다른 로그를 삭제하려고 시도했는지도 함께 조사한다. 시스템의 last 명령을 사용해 해당 사용자의 로그인, 로그아웃 시간을 확인하고, 세션 동안 어떤 활동이 있었는지 파악한다.</li>
<li>시스템 격리 및 추가 조사 : 공격자가 침투하여 추가적인 활동을 수행할 가능성이 크므로, 해당 시스템을 네트워크에서 격리하고 추가 조사를 수행해야 한다. 포렌식 분석을 통해 공격 경로와 손상 범위를 파악한다.</li>
</ol>

<h3>Mitigations</h3>

<ol>
<li><p><strong>bash_history 파일 접근 제한</strong></p>

<ul>
<li>사용자 세션에서 bash_history 파일을 마음대로 수정하거나 삭제하지 못하도록 권한을 제한한다.</li>
<li>기본적으로는 각 사용자에 맞는 권한이 부여되지만, 필요에 따라 강력한 제한을 적용할 수 있다.</li>
</ul></li>
<li><p><strong>HISTCONTROL 설정 점검</strong></p>

<ul>
<li>공격자는 HISTCONTROL 환경 변수를 설정해 명령어 기록이 남지 않도록 할 수 있다.</li>
<li>예를 들어, HISTCONTROL=ignoreboth는 공백으로 시작하는 명령이나 중복된 명령을 기록하지 않도록 한다.</li>
<li>이러한 환경 변수 설정을 주기적으로 점검하고, 필요시 이를 강제할 수 있다.</li>
</ul></li>
<li><p><strong>중앙 집중식 명령어 로깅 적용</strong></p>

<ul>
<li>bash_history와 같은 사용자별 로그는 쉽게 삭제될 수 있으므로, 중앙 집중식 로깅을 통해 명령어 실행 내역을 외부 시스템으로 기록하도록 설정할 수 있다.</li>
<li>이를 통해 개별 시스템에서 로그가 삭제되더라도 중앙 서버에서 해당 정보를 확인할 수 있다.</li>
</ul></li>
<li><p><strong>로그 삭제 방지 시스템 적용</strong></p>

<ul>
<li>로그 파일이 삭제되는 것을 방지하기 위해 파일 무결성 모니터링(FIM) 시스템을 도입해, 특정 로그 파일에 대한 삭제 또는 변경을 실시간으로 탐지하고 경고를 설정한다.</li>
</ul></li>
</ol>

<h2>Affected Techniques</h2>

<p>Action 실행시 함께 영향을 받는 다른 Techniqes </p>

<table>
<thead>
<tr>
  <th style="text-align:center;">ATT&amp;CK</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:center;">T1070.003</td>
</tr>
<tr>
  <td style="text-align:center;">T1562.003</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
  <th style="text-align:center;">D3FEND</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:center;">D3-FIM File Integrity Monitoring</td>
</tr>
<tr>
  <td style="text-align:center;">D3-SCA System Call Analysis</td>
</tr>
<tr>
  <td style="text-align:center;">D3-PM Platform Monitoring</td>
</tr>
</tbody>
</table>

</body>
</html>
