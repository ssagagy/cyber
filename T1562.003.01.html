<!DOCTYPE html>
<html>
<head>
    <title>T1562.003.01</title>
    <link rel="stylesheet" type="text/css" href="KISA_HTML_CSS.css">
</head>
<body>
<h1>T1562.003.01 방어기법 방해, 커맨드 히스토리 로킹 방해</h1>

<h2>D3FEND</h2>

<p>MITRE ATT&amp;CK 액션을 기준으로 대응 방안을 작성</p>

<h3>Detection</h3>

<p>명령어 실행 탐지를 우회하기 위해 공백 문자를 활용하는 이 기법을 탐지하기 위해서는 시스템 로그 및 명령어 실행 로그를 면밀히 분석하여 비정상적인 명령 실행을 모니터링해야 한다.</p>

<ol>
<li>로그 모니터링 : 사용자 명령어 로그를 기록하고, 이를 정기적으로 모니터링하여 공백을 활용한 비정상적인 명령어 사용을 탐지한다. 예를 들어, history 명령어를 통해 사용자가 입력한 명령어의 이력을 확인할 수 있다.</li>
<li>비정상적인 프로세스 감지 : 시스템에서 실행 중인 프로세스를 모니터링하여 비정상적으로 실행된 프로세스나 명령어를 탐지한다. 특정 프로세스가 정상적인 경로가 아닌 비정상적인 방식으로 실행된 경우 이를 기록하고 경고를 생성한다.</li>
<li>시스템 호출 모니터링 : 시스템 호출을 모니터링하여 비정상적인 호출 패턴을 탐지한다. 예를 들어, exec 또는 system 호출을 통해 실행된 명령어가 비정상적으로 공백을 포함하고 있는 경우를 감지한다.</li>
</ol>

<h3>Detection(EDR)</h3>

<ul>
<li>Splunk 탐지 예시</li>
<li>index=os<em>logs sourcetype=process</em>logs
| search command="* *"
| stats count by user, command
| where count &gt; threshold_value</li>
</ul>

<h3>Response</h3>

<ol>
<li>해당 프로세스 종료 : 비정상적인 명령어 실행이 발견된 경우 해당 프로세스를 종료한다. 시스템의 안정성을 위해 비정상적인 프로세스를 즉시 중지해야 한다.</li>
<li>로그 및 증거 수집 : 비정상적인 명령어 실행과 관련된 로그 및 증거를 수집한다. 이를 통해 향후 사건 분석 및 재발 방지를 위한 기초 자료로 활용할 수 있다.</li>
<li>시스템 및 네트워크 격리 : 감염된 시스템을 네트워크에서 격리하여 추가적인 피해를 방지한다. 이후 포렌식 분석을 통해 공격의 원인을 파악하고 추가적인 공격 징후를 조사한다.</li>
<li>사용자 통지 및 교육 : 비정상적인 행동이 발견된 사용자에게 상황을 통지하고, 보안 정책을 준수하도록 교육한다. 사용자에게 해당 기법의 위험성과 예방 방법에 대한 정보를 제공한다.</li>
</ol>

<h3>Mitigations</h3>

<ol>
<li><p><strong>보안 서비스 자동 복구 및 보호 (M1040 - Security Configurations)</strong>  </p>

<ul>
<li><strong>보안 서비스</strong>(예: <strong>침입 탐지 시스템</strong>, <strong>방화벽</strong>, <strong>보안 로그 서비스</strong>)에 대한 <strong>자동 복구 기능</strong>을 활성화하여, 서비스가 <strong>비활성화되거나 중지</strong>되었을 경우 <strong>자동으로 복구</strong>되도록 설정  </li>
<li><strong>시스템 서비스 보호</strong>를 통해 <strong>비정상적인 종료</strong>나 <strong>비활성화</strong> 시도를 탐지하고, 해당 <strong>서비스가 정상 상태로 복구</strong>되도록 설정  </li>
<li><strong>보안 서비스</strong>의 <strong>설정 변경</strong>이나 <strong>종료</strong>가 발생할 경우 <strong>즉시 알림</strong>을 받을 수 있도록 시스템을 구성  </li>
</ul></li>
<li><p><strong>서비스에 대한 액세스 제한 및 제어 (M1045 - Restrict Access to Tools)</strong>  </p>

<ul>
<li><strong>관리자 권한</strong>을 <strong>최소화</strong>하고, <strong>보안 서비스</strong>를 <strong>종료하거나 비활성화</strong>할 수 있는 <strong>사용자</strong>나 <strong>어플리케이션</strong>을 제한  </li>
<li><strong>강력한 인증</strong> 및 <strong>다단계 인증(MFA)</strong>을 적용하여 <strong>보안 서비스에 대한 무단 접근</strong>을 차단  </li>
<li><strong>보안 서비스 설정</strong>을 <strong>최소 권한의 사용자</strong>만 수정할 수 있도록 하고, <strong>특정 사용자</strong>만 서비스 종료 권한을 부여  </li>
</ul></li>
<li><p><strong>모니터링 및 경고 시스템 강화 (M1033 - Process Monitoring)</strong>  </p>

<ul>
<li><strong>보안 서비스</strong>가 <strong>실시간으로 동작</strong>하는지 모니터링하고, <strong>비정상적인 서비스 종료</strong>나 <strong>중지</strong>가 감지되면 <strong>즉시 경고</strong>를 발생  </li>
<li><strong>시스템 로그</strong> 및 <strong>보안 이벤트</strong>를 <strong>실시간으로 분석</strong>하여 <strong>보안 서비스의 비활성화</strong> 시도를 <strong>탐지하고 대응</strong>할 수 있도록 설정  </li>
<li><strong>서비스 모니터링 도구</strong>를 사용하여 <strong>보안 서비스의 동작 상태</strong>를 확인하고, <strong>변경 사항</strong>을 추적  </li>
</ul></li>
<li><p><strong>보안 패치 및 업데이트 관리 (M1047 - System Logging &amp; Monitoring)</strong>  </p>

<ul>
<li><strong>보안 서비스</strong>의 <strong>자동 패치 관리 시스템</strong>을 설정하여 최신 보안 취약점을 해결하고 <strong>보안 서비스</strong>가 항상 <strong>업데이트된 상태</strong>로 유지될 수 있도록 관리  </li>
<li><strong>패치 관리 시스템</strong>을 통해 <strong>정기적인 보안 서비스 업데이트</strong>와 <strong>보안 취약점</strong>을 해결하고, 서비스가 <strong>비활성화되거나 변경된 경우</strong> 알림을 받을 수 있도록 설정  </li>
<li><strong>업데이트 및 패치 기록</strong>을 관리하고 <strong>패치된 서비스의 무결성</strong>을 검증  </li>
</ul></li>
<li><p><strong>파일 무결성 검증 및 디지털 서명 (M1055 - Secure Data Transmission)</strong>  </p>

<ul>
<li><strong>파일 무결성 모니터링</strong>을 통해 <strong>보안 서비스</strong>의 <strong>파일 및 구성 요소</strong>에 대한 <strong>변경 여부</strong>를 실시간으로 점검  </li>
<li><strong>디지털 서명</strong> 및 <strong>무결성 검증</strong>을 활용하여 <strong>보안 서비스의 파일</strong>이나 <strong>설정</strong>이 <strong>무단으로 변경되었는지</strong> 확인하고, 이를 <strong>복구</strong>할 수 있도록 설정  </li>
<li><strong>보안 서비스의 무결성</strong>이 손상될 경우 <strong>자동 복구</strong> 절차가 작동하도록 설정  </li>
</ul></li>
<li><p><strong>침해 사고 대응 계획 (M1031 - Network Segmentation)</strong>  </p>

<ul>
<li><strong>보안 서비스 비활성화 시도</strong>에 대한 <strong>대응 절차</strong>를 명확히 정의하고, <strong>침해 사고 대응 계획</strong>을 마련하여 신속하게 대응할 수 있도록 준비  </li>
<li><strong>침해 사고 발생 시</strong> <strong>보안 서비스</strong>가 <strong>중지된 상태</strong>에서 <strong>시스템 복구</strong> 절차를 준비하고, <strong>모의 훈련</strong>을 통해 신속한 대응 능력을 강화  </li>
<li><strong>침입 탐지 시스템(IDS)</strong> 및 <strong>침입 방지 시스템(IPS)</strong>을 사용하여 <strong>비정상적인 트래픽</strong>을 탐지하고, <strong>보안 서비스</strong>의 비활성화 시도를 실시간으로 차단  </li>
</ul></li>
</ol>

<h2>Affected Techniques</h2>

<p>Action 실행시 함꼐 영향을 받는 다른 Techniqes </p>

<table>
<thead>
<tr>
  <th style="text-align:center;">ATT&amp;CK</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:center;">T1562.003</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
  <th style="text-align:center;">D3FEND</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:center;">D3-FAPA File Access Pattern Analysis</td>
</tr>
<tr>
  <td style="text-align:center;">D3-FIM File Integrity Monitoring</td>
</tr>
<tr>
  <td style="text-align:center;">D3-PLA Process Lineage Analysis</td>
</tr>
</tbody>
</table>

</body>
</html>
