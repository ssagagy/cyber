<!DOCTYPE html>
<html>
<head>
    <title>T1003.002.01</title>
    <link rel="stylesheet" type="text/css" href="KISA_HTML_CSS.css">
</head>
<body>
<h1>T1003.002.01 레지스트리 하이브 복사</h1>

<h2>D3FEND</h2>

<p>MITRE ATT&amp;CK 액션을 기준으로 대응 방안을 작성</p>

<h3>Detection</h3>

<p>CurrentProcess = "reg.exe" AND 
Cmdline = "save" AND
Cmdline = "HKLM\SYSTEM" OR "HKLM\security"</p>

<h3>Detection(EDR)</h3>

<p><img src="T1003.002.01.png" alt="T1003 002 01" /></p>

<h3>Response</h3>

<ul>
<li>모니터링: Task Manager, ProcDump, Mimikatz 등 LSASS 메모리에 접근하는 비정상적인 프로세스를 탐지한다. 비관리자 사용자에 의해 발생하는 대용량 파일 접근을 확인한다.</li>
<li>엔드포인트 보호: LSASS 메모리 덤프나 LSASS에 접근하려는 프로세스를 탐지하는 엔드포인트 탐지 및 대응(EDR) 솔루션을 사용한다.</li>
<li>권한 관리: 관리자 권한 사용을 정기적으로 감사하고, 비정상적이거나 허가되지 않은 메모리 덤프 활동을 수행하는 계정을 모니터링한다.</li>
<li>메모리 분석: 메모리 덤프에 대한 포렌식 분석을 수행하여 자격 증명 탈취 여부를 식별한다.</li>
<li>네트워크 활동: 자격 증명 탈취를 나타낼 수 있는 네트워크 트래픽 또는 자격 증명 데이터를 다른 위치로 이동하는 것을 모니터링한다.</li>
</ul>

<h3>Mitigations</h3>

<ol>
<li><p><strong>자격 증명 보호</strong>  </p>

<ul>
<li>Windows의 <strong>Credential Guard</strong> 및 <strong>LSASS 보호 모드</strong>를 활성화하여 패스워드 덤핑을 방지합니다.  </li>
<li>SAM, SYSTEM, SECURITY 레지스트리에 대한 접근을 제한합니다.  </li>
</ul></li>
<li><p><strong>보안 솔루션 강화</strong>  </p>

<ul>
<li>EDR/XDR 솔루션을 사용하여 <code data-language="powershell">mimikatz</code>, <code data-language="powershell">procdump</code> 등의 크리덴셜 덤핑 도구 실행을 탐지합니다.  </li>
<li>Microsoft Defender의 Attack Surface Reduction (ASR) 정책을 적용하여 <code data-language="powershell">lsass.exe</code> 접근을 차단합니다.  </li>
</ul></li>
<li><p><strong>이벤트 로깅 및 감사 정책 강화</strong>  </p>

<ul>
<li>Sysmon을 활용하여 <strong>Event ID 10 (ProcessAccess)</strong> 를 모니터링하고 LSASS 접근 시 경고를 생성합니다.  </li>
<li>Windows Event Log (<code data-language="powershell">4624</code>, <code data-language="powershell">4672</code>, <code data-language="powershell">4688</code>)를 분석하여 비정상적인 관리자 권한 요청을 탐지합니다.  </li>
</ul></li>
<li><p><strong>권한 제어</strong>  </p>

<ul>
<li>로컬 관리자 계정을 최소화하고 JIT(Just-In-Time) 및 JEA(Just Enough Administration)를 적용합니다.  </li>
<li>RDP 및 원격 접근을 제한하고 네트워크 레벨 인증(NLA)을 활성화합니다.  </li>
</ul></li>
<li><p><strong>레지스트리 및 시스템 설정 보호</strong>  </p>

<ul>
<li>NTLM 인증을 비활성화하고 Kerberos 인증을 기본값으로 설정합니다.  </li>
<li><code data-language="powershell">mstsc /restrictedadmin</code> 설정을 활성화하여 원격 로그인 시 크리덴셜 유출을 방지합니다.  </li>
</ul></li>
<li><p><strong>네트워크 트래픽 모니터링</strong>  </p>

<ul>
<li>SMB 및 RDP 연결을 감시하여 의심스러운 인증 시도를 탐지합니다.  </li>
<li>SIEM에서 <code data-language="powershell">sam</code>, <code data-language="powershell">security</code>, <code data-language="powershell">system</code> 등의 키워드로 로그 분석을 수행하여 비정상적인 접근을 탐지합니다.  </li>
</ul></li>
</ol>

<h2>Affected Techniques</h2>

<p>Action 실행시 함께 영향을 받는 다른 Techniqes </p>

<table>
<thead>
<tr>
  <th style="text-align:center;">ATT&amp;CK</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:center;">T1003.002</td>
</tr>
<tr>
  <td style="text-align:center;">T1059.003</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
  <th style="text-align:center;">D3FEND</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:center;">D3-FIM File Integrity Monitoring</td>
</tr>
<tr>
  <td style="text-align:center;">D3-PLA Process Lineage Analysis</td>
</tr>
<tr>
  <td style="text-align:center;">D3-PM Platform Monitoring</td>
</tr>
</tbody>
</table>

</body>
</html>
